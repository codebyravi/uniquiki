!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Perfume=i()}(this,function(){"use strict";var t=function(){return function(t,i,e){this.name=t,this.version=i,this.os=e}}(),i=function(){return function(t){this.version=t,this.name="node",this.os=process.platform}}(),e=function(){return function(){this.bot=!0,this.name="bot",this.version=null,this.os=null}}(),n=3,r=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],o=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]];function s(){return"undefined"!=typeof navigator?function(i){var s=""!==i&&r.reduce(function(t,e){var n=e[0],r=e[1];if(t)return t;var o=r.exec(i);return!!o&&[n,o]},!1);if(!s)return null;var a=s[0],u=s[1];if("searchbot"===a)return new e;var c=u[1]&&u[1].split(/[._]/).slice(0,3);c?c.length<n&&(c=c.concat(new Array(n-c.length).fill("0"))):c=[];return new t(a,c.join("."),function(t){var i=o.find(function(i){i[0];var e=i[1];return e.test(t)});return i?i[0]:null}(i))}(navigator.userAgent):"undefined"!=typeof process&&process.version?new i(process.version.slice(1)):null}var a,u,c,f,h=function(){return+new Date},d="function"==typeof window.requestIdleCallback,l=function(){function t(t){this.initTime_=t}return Object.defineProperty(t.prototype,"didTimeout",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.timeRemaining=function(){return Math.max(0,50-(h()-this.initTime_))},t}(),p=d?window.requestIdleCallback:function(t){var i=new l(h());return setTimeout(function(){return t(i)},0)},g=d?window.cancelIdleCallback:function(t){clearTimeout(t)},m="function"==typeof Promise&&Promise.toString().indexOf("[native code]")>-1?function(t){Promise.resolve().then(t)}:(a=0,u=[],c=new MutationObserver(function(){u.forEach(function(t){return t()}),u=[]}),f=document.createTextNode(""),c.observe(f,{characterData:!0}),function(t){u.push(t),f.data=String(++a%2)}),w=0,y=!("object"!=typeof window.safari||!window.safari.pushNotification),b=function(){function t(t){var i=void 0===t?{}:t,e=i.ensureTasksRun,n=void 0!==e&&e,r=i.defaultMinTaskTime,o=void 0===r?w:r;this.taskQueue_=[],this.isProcessing_=!1,this.state_=null,this.idleCallbackHandle_=null,this.taskQueue_=[],this.isProcessing_=!1,this.state_=null,this.defaultMinTaskTime_=o,this.ensureTasksRun_=n,this.runTasksImmediately=this.runTasksImmediately.bind(this),this.runTasks_=this.runTasks_.bind(this),this.onVisibilityChange_=this.onVisibilityChange_.bind(this),this.ensureTasksRun_&&(addEventListener("visibilitychange",this.onVisibilityChange_,!0),y&&addEventListener("beforeunload",this.runTasksImmediately,!0))}return t.prototype.pushTask=function(t){this.addTask_(Array.prototype.push,t)},t.prototype.unshiftTask=function(t){this.addTask_(Array.prototype.unshift,t)},t.prototype.runTasksImmediately=function(){this.runTasks_()},t.prototype.hasPendingTasks=function(){return this.taskQueue_.length>0},t.prototype.clearPendingTasks=function(){this.taskQueue_=[],this.cancelScheduledRun_()},t.prototype.getState=function(){return this.state_},t.prototype.destroy=function(){this.taskQueue_=[],this.cancelScheduledRun_(),this.ensureTasksRun_&&(removeEventListener("visibilitychange",this.onVisibilityChange_,!0),y&&removeEventListener("beforeunload",this.runTasksImmediately,!0))},t.prototype.addTask_=function(t,i,e){var n=(void 0===e?{}:e).minTaskTime,r=void 0===n?this.defaultMinTaskTime_:n,o={time:h(),visibilityState:document.visibilityState};t.call(this.taskQueue_,{state:o,task:i,minTaskTime:r}),this.scheduleTasksToRun_()},t.prototype.scheduleTasksToRun_=function(){this.ensureTasksRun_&&"hidden"===document.visibilityState?m(this.runTasks_):this.idleCallbackHandle_||(this.idleCallbackHandle_=p(this.runTasks_))},t.prototype.runTasks_=function(t){if(this.cancelScheduledRun_(),!this.isProcessing_){for(this.isProcessing_=!0;this.hasPendingTasks()&&!v(t,this.taskQueue_[0].minTaskTime);){var i=this.taskQueue_.shift(),e=i.task,n=i.state;this.state_=n,e(n),this.state_=null}this.isProcessing_=!1,this.hasPendingTasks()&&this.scheduleTasksToRun_()}},t.prototype.cancelScheduledRun_=function(){g(this.idleCallbackHandle_),this.idleCallbackHandle_=null},t.prototype.onVisibilityChange_=function(){"hidden"===document.visibilityState&&this.runTasksImmediately()},t}(),v=function(t,i){return!!(t&&t.timeRemaining()<=i)},T=function(){function t(t){this.config=t}return t.prototype.now=function(){return Date.now()/1e3},t.prototype.mark=function(t,i){},t.prototype.measure=function(t,i){return this.getDurationByMetric(t,i)},t.prototype.firstContentfulPaint=function(t){var i=this;setTimeout(function(){t(i.getFirstPaint())})},t.prototype.getDurationByMetric=function(t,i){return i.end-i.start||0},t.prototype.getFirstPaint=function(){var t=window.performance.timing,i={duration:0,entryType:"paint",name:"first-contentful-paint",startTime:0};return t&&0!==t.navigationStart&&(i.startTime=Date.now()-t.navigationStart),[i]},t}();!function(t,i){var e,n,r,o=[],s={passive:!0,capture:!0},a=new Date,u="pointerup",c="pointercancel";function f(t,o){e||(e=o,n=t,r=new Date,l(i),h())}function h(){n>=0&&n<r-a&&(o.forEach(function(t){t(n,e)}),o=[])}function d(e){if(e.cancelable){var n=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,n){function r(){f(e,n),a()}function o(){a()}function a(){i(u,r,s),i(c,o,s)}t(u,r,s),t(c,o,s)}(n,e):f(n,e)}}function l(t){["click","mousedown","keydown","touchstart","pointerdown"].forEach(function(i){t(i,d,s)})}l(t),self.perfMetrics=self.perfMetrics||{},self.perfMetrics.onFirstInputDelay=function(t){o.push(t),h()}}(addEventListener,removeEventListener);var k=function(){function t(t){this.config=t}return t.supported=function(){return window.performance&&!!performance.now&&!!performance.mark},t.supportedPerformanceObserver=function(){return window.chrome&&"PerformanceObserver"in window},t.prototype.now=function(){return window.performance.now()},t.prototype.mark=function(t,i){var e="mark_"+t+"_"+i;window.performance.mark(e)},t.prototype.measure=function(t,i){var e="mark_"+t+"_start",n="mark_"+t+"_end";return window.performance.measure(t,e,n),this.getDurationByMetric(t,i)},t.prototype.firstContentfulPaint=function(t){this.perfObserver=new PerformanceObserver(this.performanceObserverCb.bind(this,t)),this.perfObserver.observe({entryTypes:["paint"]})},t.prototype.getDurationByMetric=function(t,i){var e=this.getMeasurementForGivenName(t);return e&&"measure"===e.entryType?e.duration:-1},t.prototype.getMeasurementForGivenName=function(t){var i=window.performance.getEntriesByName(t);return i[i.length-1]},t.prototype.performanceObserverCb=function(t,i){var e=this,n=i.getEntries();t(n),n.forEach(function(t){e.config.firstContentfulPaint&&"first-contentful-paint"===t.name&&e.perfObserver.disconnect()})},t}();return function(){function t(t){void 0===t&&(t={});var i=this;this.config={firstContentfulPaint:!1,firstPaint:!1,firstInputDelay:!1,googleAnalytics:{enable:!1,timingVar:"name"},browserTracker:!1,logPrefix:"Perfume.js:",logging:!0,maxMeasureTime:15e3,warning:!1,debugging:!1},this.firstPaintDuration=0,this.firstContentfulPaintDuration=0,this.firstInputDelayDuration=0,this.isHidden=!1,this.logMetricWarn="Please provide a metric name",this.metrics=new Map,this.observers=new Map,this.didVisibilityChange=function(){document.hidden&&(i.isHidden=document.hidden)},this.config=Object.assign({},this.config,t),this.perf=k.supported()?new k(this.config):new T(this.config),this.config.browserTracker&&(this.browser=s()),k.supportedPerformanceObserver()||(this.perfEmulated=new T(this.config)),(this.config.firstPaint||this.config.firstContentfulPaint)&&(this.observeFirstContentfulPaint=new Promise(function(t){i.logDebug("observeFirstContentfulPaint"),i.observers.set("fcp",t),i.initFirstPaint()})),this.config.firstInputDelay&&(this.observeFirstInputDelay=new Promise(function(t){i.observers.set("fid",t),i.initFirstInputDelay()})),this.onVisibilityChange(),this.queue=new b({ensureTasksRun:!0})}return t.prototype.start=function(t){this.checkMetricName(t)&&(this.metrics.has(t)?this.logWarn(this.config.logPrefix,"Recording already started."):(this.metrics.set(t,{end:0,start:this.perf.now()}),this.perf.mark(t,"start"),this.isHidden=!1))},t.prototype.end=function(t){var i=this;if(this.checkMetricName(t)){var e=this.metrics.get(t);if(e){e.end=this.perf.now(),this.perf.mark(t,"end");var n=this.perf.measure(t,e),r=parseFloat(n.toFixed(2));return this.metrics.delete(t),this.queue.pushTask(function(){i.log(t,r),i.sendTiming(t,r)}),r}this.logWarn(this.config.logPrefix,"Recording already stopped.")}},t.prototype.endPaint=function(t){var i=this;return new Promise(function(e){setTimeout(function(){var n=i.end(t);e(n)})})},t.prototype.log=function(t,i){if(!this.isHidden&&this.config.logging)if(t){var e=i.toFixed(2),n="%c "+this.config.logPrefix+" "+t+" "+e+" ms";window.console.log(n,"color: #ff6d00;font-size:11px;")}else this.logWarn(this.config.logPrefix,this.logMetricWarn)},t.prototype.logDebug=function(t,i){void 0===i&&(i=""),this.config.debugging&&window.console.log("Perfume.js debugging "+t+":",i)},t.prototype.sendTiming=function(t,i){if(!this.isHidden){var e=this.config.browserTracker?this.browser:void 0,n=this.addBrowserToMetricName(t);if(this.config.analyticsTracker&&this.config.analyticsTracker(t,i,e),this.config.googleAnalytics.enable)if(window.ga){var r=Math.round(i);window.ga("send","timing",n,this.config.googleAnalytics.timingVar,r)}else this.logWarn(this.config.logPrefix,"Google Analytics has not been loaded")}},t.prototype.addBrowserToMetricName=function(t){if(!this.config.browserTracker)return t;var i=t;this.browser.name&&(i+="."+this.browser.name.replace(/\s/g,""),this.browser.os&&(i+="."+this.browser.os.replace(/\s/g,"")));return i},t.prototype.checkMetricName=function(t){return!!t||(this.logWarn(this.config.logPrefix,this.logMetricWarn),!1)},t.prototype.firstContentfulPaintCb=function(t){var i=this;this.logDebug("firstContentfulPaintCb",t),t.forEach(function(t){i.queue.pushTask(function(){i.config.firstPaint&&"first-paint"===t.name&&i.logMetric(t.startTime,"First Paint","firstPaint"),i.config.firstContentfulPaint&&"first-contentful-paint"===t.name&&i.logMetric(t.startTime,"First Contentful Paint","firstContentfulPaint")})})},t.prototype.initFirstPaint=function(){if(this.logDebug("initFirstPaint"),k.supportedPerformanceObserver()){this.logDebug("initFirstPaint.supportedPerformanceObserver");try{this.perf.firstContentfulPaint(this.firstContentfulPaintCb.bind(this))}catch(t){this.logWarn(this.config.logPrefix,"initFirstPaint failed")}}else this.perfEmulated&&(this.logDebug("initFirstPaint.perfEmulated"),this.perfEmulated.firstContentfulPaint(this.firstContentfulPaintCb.bind(this)))},t.prototype.initFirstInputDelay=function(){var t=this;k.supported()&&this.config.firstInputDelay&&perfMetrics.onFirstInputDelay(function(i,e){t.queue.pushTask(function(){t.logMetric(i,"First Input Delay","firstInputDelay")})})},t.prototype.onVisibilityChange=function(){void 0!==document.hidden&&document.addEventListener("visibilitychange",this.didVisibilityChange)},t.prototype.logMetric=function(t,i,e){var n=parseFloat(t.toFixed(2));n>this.config.maxMeasureTime||("firstPaint"===e&&(this.firstPaintDuration=n),"firstContentfulPaint"===e&&(this.firstContentfulPaintDuration=n,this.observers.get("fcp")(n)),"firstInputDelay"===e&&(this.firstInputDelayDuration=n,this.observers.get("fid")(n)),this.log(i,n),this.sendTiming(e,n))},t.prototype.logWarn=function(t,i){this.config.warning&&this.config.logging&&window.console.warn(t,i)},t}()});
//# sourceMappingURL=perfume.umd.min.js.map
